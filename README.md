# ci.puppet.wlp

Puppet modules for installing and managing WebSphere Application Server Liberty Profile #devops

## Description
  
The liberty module installs and configures WebSphere Application Server Liberty Profile. It provides manifests and templates for creating, managing and configuring Liberty profile server instances.
  
## Basic Configuration

  The wlp module can install Liberty profile from jar archives or zip files. The installation method is configured via the *wlp::mode* parameter.
  
### Jar installation:
  
  Jar installation is used to install Liberty from the jar file installable that is provided on wasdev.net. You must set the parameter *wlp::acceptLicense* to true before invoking the class *wlp::install* which will install the WebSphere Liberty Profile. If you do not set this
  variable the installation will fail. By default the install class is configured to use the jar installation method. 
  
### Zip installation:
  
  Zip installation is used to install Liberty from a zip archive. The zip is assumed to be generated by running *./bin/server package* Liberty command with *--include=all* or *--include=minify* option. You would need to set the *wlp::mode* parameter to *zip* in order to trigger
  a zip installation.
  
## Requirements


### Platform: 
  
    Centos  
    Redhat  

## Modules:

    No modules at this time.  
Note: The wlp::java_home variable needs to be set for this module to work correctly at this time.
  
## Parameters

The following parameters can be used to configure the wlp module  

*acceptLicense* = Whether or not you accept the Liberty License. eg:  
     
     $acceptLicense = "true"  

*serverName* = The name of the liberty server that should be created on each node. eg:  
     
     $serverName = "server1"  

*baseDir* = The parent directory into which the liberty profile will be installed. Note that this is just the directory name and not the full path. eg:  
     
     $baseDir = "liberty"  

*appNames* = Defines the names of the applications that will be installed onto the server. eg:  
     
     $appNames = [ 'acmeair-webapp-1.0-SNAPSHOT.war','DefaultApplication.ear',]  

*install_root* = The base installation directory for the Liberty Profile. eg:   
     
     $install_root="/opt/IBM/"  

*serverBinaryName* = The name of the WebSphere Liberty Base binary. eg:   
     
     $serverBinaryName="wlp-developers-runtime-8.5.5.1.jar"  

*appsDirName* = The name of the directory that contains the application content for installation in the files directory of the puppet wlp module. eg:  
     
     $appsDirName = "apps"   

*extendedBinaryName* = The name of the WebSphere Liberty extended binary.eg:  
     
     $extendedBinaryName="wlp-developers-extended-8.5.5.1.jar"  

*extrasBinaryName* = The name of the WebSphere Liberty Extras binary. eg:  
     
     $extrasBinaryName="wlp-developers-extras-8.5.5.1.jar"  

*mode* = The mode of installation. There are two modes of installation namely 'zip' and 'archive'. eg:  
     
     $mode = "archive"  

*artifact* = The artifact to install. can be *base*, *extended*, *extras*. eg:  
     
     $artifact = "base"  

*action* = The action that should be performed. Possible values are *install* and *uninstall*. eg:  
     
     $action = "install"  

*java_home* = The directory where Java is installed. eg:  
     
     $java_home = "/usr/lib/jvm/java-1.6.0"  

*puppetFileRoot* = This is the location where all the installables should be present in case of standalone puppet. In the case of master agent puppet, this is the location where the master will copy the installable files. eg:  
     
     $puppetFileRoot="${userHome}"  
                 
*includesDir* = This is the directory where all the xml files that need to be included into server.xml are placed. Each application can provide an xml file snippet that will be included in the final server.xml. This snippet can contain all the features and config that is needed for that application. eg:  
     
     $includesDir ="${wlp::variables::install_root}/${baseDir}/wlp/usr/servers/${serverName}/includes"  
              
*applicationSourceDirectory* = The complete path to the directory containing application files. eg:   

     $applicationSourceDirectory = "${userHome}/${appsDirName}"  

*path* = This is used internally and is the path used for puppet spawned shells. eg:  

     $path = "${wlp::variables::java_home}/bin:/opt/puppet/bin:${wlp::variables::install_root}/${baseDir}/wlp/bin:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin"  

## Standalone Puppet Usage

 If you want to install Liberty and deploy an application to it on a machine that has puppet installed you need to create a puppet manifest file and paste the following into it.  

     class { "wlp":
          appNames => ['DefaultApplication.ear',],
          puppetFileRoot => "/home/puppetuser",
          serverBinaryName => "wlp-developers-runtime-8.5.5.1.jar",
          standalone => true,
          acceptLicense => true
     }

First you will need to specify the applications that need to be installed via the *appNames* parameter. You can specify multiple application names as an array.
Next you need to specify the *applicationSourceDirectory* parameter or the *puppetFileRoot* parameter so that the wlp module knows where your application artifacts are present. The 
directory specified by *applicationSourceDirectory* should contain the following 2 files for each application

 1) Application Archive. eg: DefaultApplication.ear  
 2) snippet to include in server.xml. eg:DefaultApplication.xml  
 Note that the names should be the same and the extensions will only be different.  
 
The property *puppetFileRoot* is used to determine the location where your Liberty installable is present and *serverBinaryName* to determine the name of the Liberty installable file. 
Applying this manifest will result in Liberty being installed and the applications specified deployed. Finally the server is started.
 
## Master Agent Puppet Usage

Another usecase would be to install Liberty across multiple nodes. This can be achieved if the nodes are having puppet agents that are federated to a puppet master. 
In such a case you would need to modify the site.pp manifest file of the puppet master as shown below. You can define a base node that all your nodes that require 
Liberty installed should extend from. Shown below is a sample base Node for installing Liberty and an application.

    node base {
        class { "wlp":
            appNames => ['DefaultApplication.ear',],
            puppetFileRoot => "/home/puppetuser",
            serverBinaryName => "wlp-developers-runtime-8.5.5.1.jar",
            standalone => false,
            acceptLicense => true
        }
        class { "wlp::copy_files":}->
        class { "wlp::install": } ->
        class { "wlp::create_server": } ->
        class { "wlp::install_application": } ->
        class { "wlp::start_server": }
    } 

A Node extending the base node.

    node 'libertyagent' inherits base {
    }

An important thing to note here is the location of the files including the application files and the installable files. 
The installable files need to be present in the files directory of the puppet module. So the default location would be 
*/etc/puppetlabs/puppet/modules/wlp/files*. The application files should be present in the directory referred to by 
the *appsDirName* variable. By default the value of this variable is *apps*. So the location where the application artifacts 
should be present is */etc/puppetlabs/puppet/modules/wlp/files/apps*. The reason that we need to put these files in 
this location is to enable the file server present in the puppet master to server these files to the nodes where the 
puppet agent is running which needs access to these files.


## Notice

Â© Copyright IBM Corporation 2013, 2014.

## License

```text
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
```
